<!DOCTYPE html>
<html>
  <head>
    <title>Classify - Intelligent Classroom App</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        padding: 40px;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        max-width: 500px;
        width: 100%;
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        font-size: 28px;
      }

      .subtitle {
        color: #666;
        margin-bottom: 30px;
        font-size: 14px;
      }

      .upload-area {
        border: 2px dashed #667eea;
        border-radius: 10px;
        padding: 30px;
        margin: 20px 0;
        background: #f8f9ff;
        transition: all 0.3s ease;
      }

      .upload-area:hover {
        border-color: #764ba2;
        background: #f0f2ff;
      }

      .file-input-wrapper {
        position: relative;
        overflow: hidden;
        display: inline-block;
      }

      input[type="file"] {
        font-size: 14px;
        padding: 10px;
        cursor: pointer;
      }

      .file-name {
        margin-top: 15px;
        color: #667eea;
        font-weight: bold;
        min-height: 20px;
      }

      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 15px 40px;
        font-size: 16px;
        border-radius: 50px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: bold;
        width: 100%;
        margin-top: 20px;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }

      button:active {
        transform: translateY(0);
      }

      button:disabled {
        background: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      .loading {
        display: none;
        margin-top: 20px;
        color: #667eea;
      }

      .loading.active {
        display: block;
      }

      .spinner {
        border: 3px solid #f3f3f3;
        border-top: 3px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 10px auto;
      }

      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }

      .info {
        background: #e8f4fd;
        border-left: 4px solid #2196F3;
        padding: 15px;
        margin-top: 20px;
        border-radius: 5px;
        text-align: left;
        font-size: 13px;
        color: #555;
      }

      .info strong {
        color: #2196F3;
      }

      .toggle-section {
        margin: 25px 0;
        padding: 20px;
        background: #f8f9ff;
        border-radius: 10px;
      }

      .mat-slide-toggle {
        display: inline-flex;
        align-items: center;
        gap: 16px;
        cursor: pointer;
        user-select: none;
        position: relative;
      }

      .mat-slide-toggle input[type="checkbox"] {
        position: absolute;
        opacity: 0;
        pointer-events: none;
      }

      .mat-slide-toggle-bar {
        position: relative;
        width: 36px;
        height: 14px;
        background-color: rgba(0, 0, 0, 0.38);
        border-radius: 8px;
        transition: background-color 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .mat-slide-toggle-thumb {
        position: absolute;
        top: -3px;
        left: 0;
        width: 20px;
        height: 20px;
        background-color: #fafafa;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.25);
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .mat-slide-toggle input:checked + .mat-slide-toggle-bar {
        background-color: rgba(102, 126, 234, 0.54);
      }

      .mat-slide-toggle input:checked + .mat-slide-toggle-bar .mat-slide-toggle-thumb {
        background-color: #667eea;
        transform: translateX(16px);
      }

      .mat-slide-toggle:hover .mat-slide-toggle-thumb {
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.35);
      }

      .mat-slide-toggle input:focus + .mat-slide-toggle-bar .mat-slide-toggle-thumb {
        box-shadow: 0 0 0 8px rgba(102, 126, 234, 0.12);
      }

      .toggle-text {
        font-size: 14px;
        color: #999;
        font-weight: 500;
        transition: color 0.3s ease;
      }

      .toggle-text.active {
        color: #667eea;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üéì Classify</h1>
      <p class="subtitle">Intelligent Classroom App - Convert Lectures to Notes</p>

      <form id="uploadForm" action="/upload" method="post" enctype="multipart/form-data">
        <div class="upload-area">
          <div class="file-input-wrapper">
            <input 
              type="file" 
              id="audioFile" 
              name="audio" 
              accept="audio/*,.mp3,.wav,.m4a,.ogg,.flac" 
              required 
            />
          </div>
          <div class="file-name" id="fileName">No file selected</div>
        </div>

        <div class="toggle-section">
          <label class="mat-slide-toggle">
            <span class="toggle-text">üìÑ Raw Transcript</span>
            <input type="checkbox" id="summarizeToggle" name="summarize" checked>
            <span class="mat-slide-toggle-bar">
              <span class="mat-slide-toggle-thumb"></span>
            </span>
            <span class="toggle-text active">‚ú® Summarized Notes</span>
          </label>
        </div>

        <button type="submit" id="submitBtn">
          üìù Convert to Notes
        </button>

        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>Processing your audio... This may take a minute.</p>
        </div>
      </form>

      <div class="info">
        <strong>Supported formats:</strong> MP3, WAV, M4A, OGG, FLAC<br>
        <strong>Max file size:</strong> 25 MB<br>
        <strong>Process:</strong> Transcribe ‚Üí Summarize ‚Üí Generate PDF
      </div>
    </div>

    <script>
      const fileInput = document.getElementById('audioFile');
      const fileName = document.getElementById('fileName');
      const form = document.getElementById('uploadForm');
      const submitBtn = document.getElementById('submitBtn');
      const loading = document.getElementById('loading');
      const summarizeToggle = document.getElementById('summarizeToggle');
      const toggleTexts = document.querySelectorAll('.toggle-text');

      // Update toggle text styling
      summarizeToggle.addEventListener('change', function() {
        if (this.checked) {
          toggleTexts[0].classList.remove('active');
          toggleTexts[1].classList.add('active');
        } else {
          toggleTexts[0].classList.add('active');
          toggleTexts[1].classList.remove('active');
        }
      });

      // Show selected file name
      fileInput.addEventListener('change', function(e) {
        if (this.files && this.files.length > 0) {
          const file = this.files[0];
          const sizeMB = (file.size / (1024 * 1024)).toFixed(2);
          fileName.textContent = `${file.name} (${sizeMB} MB)`;
          
          // Check file size
          if (file.size > 25 * 1024 * 1024) {
            alert('File size exceeds 25 MB limit. Please choose a smaller file.');
            this.value = '';
            fileName.textContent = 'No file selected';
          }
        } else {
          fileName.textContent = 'No file selected';
        }
      });

      // Show loading state on form submit
      form.addEventListener('submit', function(e) {
        if (!fileInput.files || fileInput.files.length === 0) {
          e.preventDefault();
          alert('Please select an audio file first.');
          return;
        }

        // Prevent default form submission
        e.preventDefault();

        // Show loading state
        submitBtn.disabled = true;
        submitBtn.textContent = '‚è≥ Processing...';
        loading.classList.add('active');

        // Create FormData and submit via fetch
        const formData = new FormData(form);

        fetch('/upload', {
          method: 'POST',
          body: formData
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Upload failed');
          }
          return response.blob();
        })
        .then(blob => {
          // Create download link
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `Classify_Notes_${new Date().getTime()}.pdf`;
          document.body.appendChild(a);
          a.click();
          window.URL.revokeObjectURL(url);
          document.body.removeChild(a);

          // Reset form
          form.reset();
          fileName.textContent = 'No file selected';
          submitBtn.disabled = false;
          submitBtn.textContent = '‚úÖ Done! Convert Another?';
          loading.classList.remove('active');

          // Reset button text after 3 seconds
          setTimeout(() => {
            submitBtn.textContent = 'üìù Convert to Notes';
          }, 3000);
        })
        .catch(error => {
          console.error('Error:', error);
          alert('Failed to process audio. Please try again.');
          submitBtn.disabled = false;
          submitBtn.textContent = 'üìù Convert to Notes';
          loading.classList.remove('active');
        });
      });

      // Handle page refresh
      window.addEventListener('beforeunload', function() {
        if (submitBtn.disabled) {
          return 'Processing is in progress. Are you sure you want to leave?';
        }
      });
    </script>
  </body>
</html>